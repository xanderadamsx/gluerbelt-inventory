<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Menasha PHL Equipment Hub</title>

  <style>
    :root {
      --bg: #ffffff;
      --text: #2c3e50;
      --table-bg: #f4f4f4;
      --highlight: yellow;
      --nav-link: #2980b9;
      --button-bg: #2980b9;
      --button-text: #ffffff;
    }

    body.dark {
      --bg: #1e1e1e;
      --text: #e6e6e6;
      --table-bg: #333333;
      --highlight: #ffeb3b;
      --nav-link: #82c7ff;
      --button-bg: #3b82f6;
      --button-text: #ffffff;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: var(--bg);
      color: var(--text);
      transition: background-color 0.3s, color 0.3s;
    }

    h1, h2, h3 { color: var(--text); }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
      overflow-x: auto;
      display: block;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: var(--table-bg);
      color: var(--text);
    }

    nav ul {
      list-style: none;
      padding: 0;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }

    nav a {
      text-decoration: none;
      color: var(--nav-link);
      font-weight: bold;
    }

    #searchBar {
      width: 70%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
    }

    #searchButton,
    .export-btn,
    #exportAllBtn {
      padding: 8px 16px;
      font-size: 14px;
      margin-left: 10px;
      background-color: var(--button-bg);
      color: var(--button-text);
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }

    #searchButton:hover,
    .export-btn:hover,
    #exportAllBtn:hover {
      opacity: 0.9;
    }

    mark {
      background-color: var(--highlight);
      font-weight: bold;
      animation: fadeIn 0.4s ease-in-out;
    }

    @keyframes fadeIn {
      from { background-color: transparent; }
      to { background-color: var(--highlight); }
    }

    #loginScreen {
      max-width: 400px;
      margin: 100px auto;
      padding: 20px;
      border: 1px solid #ccc;
      background-color: var(--table-bg);
    }

    #appContent { display: none; }

    /* DARK MODE TOGGLE */
    #darkToggle {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 26px;
      cursor: pointer;
      display: none;
      transition: transform 0.3s;
      z-index: 1000;
    }

    #darkToggle:hover {
      transform: scale(1.15);
    }

    /* MOBILE */
    @media (max-width: 600px) {
      #searchBar { width: 100%; margin-bottom: 10px; }
      #searchButton { width: 100%; margin-left: 0; margin-bottom: 10px; }
      nav ul { gap: 10px; }
      .export-btn { margin-left: 0; margin-bottom: 10px; }
    }
  </style>
</head>

<body>

<!-- DARK MODE TOGGLE (hidden until login) -->
<div id="darkToggle">üåô</div>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <h2>üîê Login to Menasha Hub</h2>
  <input type="text" id="username" placeholder="Username"><br><br>
  <input type="password" id="password" placeholder="Password"><br><br>
  <button onclick="checkLogin()">Login</button>
  <p id="loginError" style="color:red;"></p>
</div>

<!-- MAIN APP -->
<div id="appContent">
  <h1>üõ†Ô∏è Menasha PHL Equipment Hub</h1>
  <p>Centralized reference for all plant assets, belt usage, schematics, and maintenance tracking.</p>

  <input type="text" id="searchBar" placeholder="Search equipment, serials, notes...">
  <button id="searchButton" onclick="runSearch()">Search</button>

  <nav>
    <ul>
      <li><a href="#floor-assets">üìç Floor Assets</a></li>
      <li><a href="#serial-log">üßæ Serial Log</a></li>
      <li><a href="#blueprints">üìÇ Blueprints</a></li>
      <li><a href="belts.html" target="_blank">üßµ Belt Inventory</a></li>
      <li><a href="maintenance-log.html" target="_blank">üß∞ Maintenance Log</a></li>
      <li><a href="schematics.html" target="_blank">üìê Schematics</a></li>
      <li><a href="training.html" target="_blank">üéì Training & SOPs</a></li>
      <li>
        <a href="https://onedrive.live.com/personal/35b820388d83ca71/_layouts/15/Doc.aspx?sourcedoc={d07eaf96-1ec4-49c2-8a7a-22cb8f9e48f0}&action=edit&redeem=aHR0cHM6Ly8xZHJ2Lm1zL28vYy8zNWI4MjAzODhkODNjYTcxL0VwYXZmdERFSHNKSmlub2l5NC1lU1BBQlpCd00xRWk0Z0ZLdDdnbkFtZEhjSUE_ZT1lUFZlSzQ&wd=target%28menasha%20ground%20work.one%7C2487b903-8096-4619-8626-0ffd2b720996%2FMenasha%20Maint-%20PHL%7C1795317a-288b-4749-ac42-4e9fa6a3f28e%2F%29&wdorigin=NavigationUrl"
           target="_blank">
          üìò OneNote Machine Log
        </a>
      </li>
    </ul>
  </nav>

  <h2 id="floor-assets">üìç Equipment by Location</h2>
  <button class="export-btn" onclick="exportTableToCSV('floor-assets-table', 'floor_assets.csv')">
    Export Floor Assets CSV
  </button>
  <table id="floor-assets-table">
    <tr><th>Asset</th><th>Tool Type</th><th>Notes</th></tr>
    <tr><td>5-Color & 7-Color Presses</td><td>Standard</td><td>Access Code: 42883</td></tr>
    <tr><td>2000</td><td>Metric</td><td></td></tr>
    <tr><td>Master Cut</td><td>Metric</td><td></td></tr>
    <tr><td>Pacific</td><td>Metric</td><td>Mosca Code: 44711</td></tr>
    <tr><td>Asitrade KP-PH</td><td>Metric</td><td>Serial: 2010-111, Built 2010</td></tr>
    <tr><td>Asitrade ABST</td><td>Metric</td><td>Serial: 200100111, Built 2010</td></tr>
    <tr><td>Pallet Wrap Station</td><td>Standard</td><td></td></tr>
    <tr><td>Mainline Conveyor System</td><td>Mixed</td><td></td></tr>
    <tr><td>Back Rails & Conveyor System</td><td>Mixed</td><td></td></tr>
    <tr><td>Baler</td><td>Standard</td><td>Bale Master</td></tr>
    <tr><td>Bander (back side)</td><td>Metric</td><td></td></tr>
  </table>

  <h2 id="serial-log">üßæ Equipment Serial Log</h2>
  <button class="export-btn" onclick="exportTableToCSV('serial-log-table', 'serial_log.csv')">
    Export Serial Log CSV
  </button>
  <table id="serial-log-table">
    <tr><th>Serial</th><th>Type</th><th>Model</th><th>Blueprint</th><th>Notes</th></tr>
    <tr><td>2010-111</td><td>Feeder Module</td><td>KP-PH</td><td><a href="#">Placeholder</a></td><td>Asitrade, Built 2010</td></tr>
    <tr><td>200100111</td><td>Feeder Module</td><td>ABST</td><td><a href="#">Placeholder</a></td><td>Asitrade, Built 2010</td></tr>
    <tr><td>DRF600</td><td>Conveyor System</td><td>ACS BP6306-B-1</td><td><a href="#">Placeholder</a></td><td>460V 3PH, Built 2002</td></tr>
    <tr><td>0351 005 04</td><td>Industrial Printer</td><td>Domino 165 Matic</td><td><a href="#">Placeholder</a></td><td>240V AC, Single Phase</td></tr>
  </table>

  <h2 id="blueprints">üìÇ Equipment Blueprints</h2>
  <button class="export-btn" onclick="exportTableToCSV('blueprints-table', 'blueprints.csv')">
    Export Blueprints CSV
  </button>
  <table id="blueprints-table">
    <tr><th>Machine</th><th>Serial Number</th><th>Blueprint Link</th></tr>
    <tr><td>Expertfold 1</td><td>BSA03542000061</td><td><a href="#">Placeholder</a></td></tr>
    <tr><td>Expertfold 2</td><td>BSA052F3001247</td><td><a href="#">Placeholder</a></td></tr>
    <tr><td>Domino 165 Matic</td><td>0351 005 04</td><td><a href="#">Placeholder</a></td></tr>
  </table>

  <br>
  <button id="exportAllBtn" onclick="exportAllTablesToCSV('menasha_equipment_hub_all_tables.csv')">
    Export ALL Tables CSV
  </button>
</div>

<script>
  // APPLY PERSISTENT DARK MODE ON LOAD + LIVE SEARCH BINDINGS
  document.addEventListener("DOMContentLoaded", () => {
    const savedTheme = localStorage.getItem("menashaTheme");
    const toggle = document.getElementById("darkToggle");

    if (savedTheme === "dark") {
      document.body.classList.add("dark");
      toggle.textContent = "‚òÄÔ∏è";
    } else {
      toggle.textContent = "üåô";
    }

    const searchBar = document.getElementById('searchBar');
    searchBar.addEventListener('keydown', function (event) {
      if (event.key === 'Enter') {
        runSearch();
      }
    });

    // LIVE SEARCH
    searchBar.addEventListener('input', function () {
      runSearch();
    });
  });

  // LOGIN FUNCTION
  function checkLogin() {
    const user = document.getElementById("username").value;
    const pass = document.getElementById("password").value;

    if (
      (user === "cabron" && pass === "wherearemy") ||
      (user === "maintenance" && pass === "password")
    ) {
      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("appContent").style.display = "block";
      document.getElementById("darkToggle").style.display = "block";
    } else {
      document.getElementById("loginError").textContent = "Invalid credentials. Try again.";
    }
  }

  // DARK MODE TOGGLE
  const toggle = document.getElementById("darkToggle");
  toggle.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    const isDark = document.body.classList.contains("dark");
    toggle.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
    localStorage.setItem("menashaTheme", isDark ? "dark" : "light");
  });

  // SEARCH FUNCTION (USED BY LIVE + BUTTON + ENTER)
  function runSearch() {
    const query = document.getElementById('searchBar').value.toLowerCase();
    const tables = document.querySelectorAll('table');

    tables.forEach(table => {
      const rows = table.querySelectorAll('tr');

      rows.forEach((row, index) => {
        const cells = row.querySelectorAll('td');

        if (index === 0) {
          row.style.display = '';
          return;
        }

        let matchFound = false;

        cells.forEach(cell => {
          const originalText = cell.textContent;
          const lowerText = originalText.toLowerCase();

          cell.innerHTML = originalText;

          if (query !== '' && lowerText.includes(query)) {
            matchFound = true;
            const regex = new RegExp(`(${query})`, 'gi');
            cell.innerHTML = originalText.replace(regex, '<mark>$1</mark>');
          }
        });

        row.style.display = matchFound || query === '' ? '' : 'none';
      });
    });
  }

  // EXPORT SINGLE TABLE TO CSV
  function exportTableToCSV(tableId, filename) {
    const table = document.getElementById(tableId);
    if (!table) return;

    let csv = [];
    const rows = table.querySelectorAll('tr');

    rows.forEach(row => {
      const cols = row.querySelectorAll('th, td');
      let rowData = [];
      cols.forEach(col => {
        // Strip HTML (e.g., links) and keep text
        let text = col.innerText.replace(/\n/g, ' ').replace(/"/g, '""');
        rowData.push(`"${text}"`);
      });
      csv.push(rowData.join(','));
    });

    downloadCSV(csv.join('\n'), filename);
  }

  // EXPORT ALL TABLES TO ONE CSV
  function exportAllTablesToCSV(filename) {
    const tables = [
      { id: 'floor-assets-table', title: 'Floor Assets' },
      { id: 'serial-log-table', title: 'Serial Log' },
      { id: 'blueprints-table', title: 'Blueprints' }
    ];

    let csv = [];

    tables.forEach((tbl, index) => {
      const table = document.getElementById(tbl.id);
      if (!table) return;

      // Section header
      csv.push(`"${tbl.title}"`);
      const rows = table.querySelectorAll('tr');

      rows.forEach(row => {
        const cols = row.querySelectorAll('th, td');
        let rowData = [];
        cols.forEach(col => {
          let text = col.innerText.replace(/\n/g, ' ').replace(/"/g, '""');
          rowData.push(`"${text}"`);
        });
        csv.push(rowData.join(','));
      });

      if (index < tables.length - 1) {
        csv.push(''); // blank line between tables
      }
    });

    downloadCSV(csv.join('\n'), filename);
  }

  // DOWNLOAD HELPER
  function downloadCSV(csvContent, filename) {
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.setAttribute("href", url);
    link.setAttribute("download", filename);
    link.style.display = "none";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
  }
</script>

</body>
</html>
